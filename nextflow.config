// 定义参数 - 可以在命令行中覆盖
params {

    help = false                // Show help message
    version = false             // Show version information
    samplesheet = '/cpfs01/projects-HDD/cfff-86962b7a8e68_HDD/xlf_22110700075/SingleCell/data/paired_end_qc_samples.tsv'
    outdir = '/cpfs01/projects-HDD/cfff-86962b7a8e68_HDD/xlf_22110700075/SingleCell/results'
    
     // 结构化输出目录配置
    output_structure = [
        individual_assemblies: "${outdir}/01_individual_assemblies",
        similarity_analysis: "${outdir}/02_similarity_analysis", 
        clustering_analysis: "${outdir}/03_clustering_analysis",
        co_assemblies: "${outdir}/04_co_assemblies",
        taxonomic_classification: "${outdir}/05_taxonomic_classification",
        final_results: "${outdir}/06_final_results",
        logs_diagnostics: "${outdir}/07_logs_and_diagnostics"
    ]
    
    // 汇总报告配置
    keep_intermediate = false

    // 资源相关
    max_memory = '480.GB'
    max_cpus = 20
    max_time = '24.h'
    sif_dir = '/cpfs01/projects-SSD/cfff-86962b7a8e68_SSD/public/singularity_sif'
    // spades parameters
    spades {
        container = params.sif_dir +"/spades_3.15.5.sif"
        kmers = "21,33,55"
        sc = true             // Enable single-cell mode
        careful = true        // Enable careful mode
        disable_rr = true     // Disable repeat resolution
        disable_gzip = true   // Disable gzip compression for output files
        additional_args = "--cov-cutoff 2 --phred-offset 33"  // Additional arguments to pass to SPAdes
    }
    // checkm2 parameters
    checkm2 {
        container =  params.sif_dir +"/checkm2_1.0.2.sif"
        threads = 16
        database = "/cpfs01/projects-SSD/cfff-86962b7a8e68_SSD/public/checkM_db/CheckM2_database/uniref100.KO.1.dmnd"
        additional_args = ""
    }
    checkm2_spades {
        container = params.sif_dir + "/python_20251106.sif"  // 你创建的多工具容器
        spades_path = "/opt/conda/envs/spades/bin/spades.py"
        checkm2_database = "/cpfs01/projects-SSD/cfff-86962b7a8e68_SSD/public/checkM_db/CheckM2_database/uniref100.KO.1.dmnd"
    }
    // Sourmash parameters (Enhanced)
    sourmash {
        // 使用参数引用而不是字符串插值
        container = params.sif_dir + "/sourmash_4.9.2--hdfd78af_0.sif"
        
        // Core parameters (matching published method: sourmash v2.0 default settings)
        ksize = 51                       // K-mer size for MinHash sketches
        scaled = 100                     // Reduced scaled parameter for higher precision (was 1000)
        
        // Quality filtering parameters
        enable_quality_filter = false    // Temporarily disable to debug clustering issue
        min_similarity_threshold = 0.05  // Minimum similarity for connection
        min_connections = 1              // Minimum number of connections required
        
        // Performance tuning
        max_parallel_sketches = 50       // Limit parallel sketch generation
        chunk_size = 100                 // Process signatures in chunks
        
        // Analysis options
        connectivity_analysis = true     // Perform connectivity analysis
        compute_containment = true       // Compute containment metrics
        
        // Resource allocation
        sketch_cpus = 20                 // CPUs for sketch generation
        sketch_memory = '200.GB'         // Memory for sketch generation
        matrix_cpus = 20                 // CPUs for similarity matrix computation
        matrix_memory = '320.GB'         // Memory for similarity matrix computation
        matrix_time = '24.h'             // Time limit for matrix computation
    }
     python {
        container =  params.sif_dir + "/python3.8_v1_Bio_0813.sif"
    }

    gtdb {
        container =  params.sif_dir + "/gtdbtk_with_ps.sif"
        threads = 24               // Number of threads for GTDB-Tk
        memory = '30G'            // Memory for GTDB-Tk
        min_perc_aa = 10          // Minimum percentage of amino acids (default 10)
        skip_ani_screen = true   // Skip ANI screening step
        database  = "/cpfs01/projects-SSD/cfff-86962b7a8e68_SSD/public/db/GTDB/release220"
    }
    // Hierarchical clustering parameters (SciPy-based)
    hierarchical_clustering {
        // Core clustering parameters (matching published method)
        linkage_method = "complete"     // Linkage method: complete, average, single, ward
        distance_metric = "euclidean"   // Distance metric: euclidean, cosine, manhattan
        criterion = "inconsistent"     // Clustering criterion: inconsistent, distance, maxclust
        threshold = 0.95               // Threshold for clustering criterion
        
        // Quality control parameters
        min_cluster_size = 2           // Minimum cluster size to consider
        max_cluster_size = 50          // Maximum cluster size before warning
        min_similarity_in_cluster = 0.2 // Minimum mean similarity within clusters
        
        // Analysis options
        generate_dendrogram = true     // Generate dendrogram visualization
        compute_validation_metrics = true // Compute cophenetic correlation and other metrics
        detailed_cluster_analysis = true  // Perform detailed cluster quality assessment
        
        // Container (using scipy-enabled Python environment)
        
        // Resource allocation
        matrix_cpus = 12                // CPUs for distance matrix conversion
        matrix_memory = '160.GB'        // Memory for distance matrix conversion
        clustering_cpus = 8            // CPUs for hierarchical clustering
        clustering_memory = '320.GB'    // Memory for hierarchical clustering
        clustering_time = '10.h'        // Time limit for clustering
        report_cpus = 2                // CPUs for report generation
        report_memory = '8.GB'         // Memory for report generation
    }
}

// 引入配置文件
includeConfig 'conf/base.config'